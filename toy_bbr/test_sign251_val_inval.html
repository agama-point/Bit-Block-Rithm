<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>ESS251 ECC – Validace vs. Invalidace</title>
<script src="js/jquery.min.js"></script>
<script src="js/ash24.js"></script>
<script src="js/ess251.js"></script>
<style>
  body { font-family: monospace; background: #111; color: #0f0; padding: 20px; font-size: 13px; }
  button { padding: 10px; cursor: pointer; background: #222; color: #0f0; border: 1px solid #0f0; }
  .output { margin-top: 15px; white-space: pre-wrap; line-height: 1.4; }
  .ok { color: #0f0; }
  .fail { color: #f55; }
</style>
</head>
<body>

<h2>ECC Test: Validní vs. Invalidní podpisy (1-16)</h2>
<button id="runBtn">Spustit cyklus</button>
<div class="output" id="demoOutput"></div>

<script>
$(document).ready(function() {
  const hex24 = (n) => "0x" + n.toString(16).padStart(6,'0');
  
  $("#runBtn").click(function() {
    let out = $("#demoOutput").text("");
    
    // Klíč Alice
    let alice_priv = 111;
    let alice_pub = scalar_mult(alice_priv, G_POINT);

    out.append(`Alice PK: [${alice_pub}]\n`);
    out.append(`--------------------------------------------------------------------------------\n`);
    out.append(`MSG  | HASH     | KLÍČ PRO OVĚŘENÍ        | VÝSLEDEK\n`);
    out.append(`--------------------------------------------------------------------------------\n`);

    for (let i = 1; i <= 24; i++) {
      let msg = "" + i;
      let h = ASH24(msg);
      
      // Alice podepisuje
      let sig = signToy(alice_priv, h);

      // Střídáme: sudé = správně (Alice), liché = špatně (Náhodný klíč)
      let useValidKey = (i % 2 === 0);
      let verify_pub;
      let keyLabel;

      if (useValidKey) {
        verify_pub = alice_pub;
        keyLabel = "Alice (Valid) ";
      } else {
        // Generování náhodného klíče pro liché kroky
        let fake_priv = Math.floor(Math.random() * (ORDER_N - 2)) + 1;
        verify_pub = scalar_mult(fake_priv, G_POINT);
        keyLabel = "Náhodný (Fake)";
      }

      let isValid = verifyToy(verify_pub, h, sig);
      let status = isValid ? "✅ VALID" : "❌ INVALID";
      let statusClass = isValid ? "ok" : "fail";

      out.append(`${msg.padEnd(4)} | ${hex24(h)} | ${keyLabel} [${verify_pub.toString().substring(0,10)}...] | ${status}\n`);
    }
    out.append(`--------------------------------------------------------------------------------\n`);
  });
});
</script>

</body>
</html>